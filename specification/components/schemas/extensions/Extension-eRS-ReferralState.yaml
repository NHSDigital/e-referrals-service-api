title: Extension-eRS-ReferralState
description: Extension to outline the current state of a ReferralRequest within e-RS.
type: object
required:
  - url
  - extension
properties:
  url:
    type: string
    enum:
      - https://fhir.nhs.uk/STU3/StructureDefinition/Extension-eRS-ReferralState-1
    example: 'https://fhir.nhs.uk/STU3/StructureDefinition/Extension-eRS-ReferralState-1'
  extension:
    type: array
    description: |
      | Field                                      | Cardinality | Notes                                                                            |
      | ------------------------------------------ | ----------- | -------------------------------------------------------------------------------- |
      | `state`                                    | `1..1`      | Outlines the current state of the `ReferralRequest`                              |
      | `reason`                                   | `0..1`      | Details the reason why the `ReferralRequest` is in this state, where appropriate |
      | `comments`                                 | `0..1`      | Any comments around the current `ReferralRequest` state                          |
    items:
      anyOf:
        - type: object
          required:
            - url
            - valueCoding
          properties:
            url:
              type: string
              enum:
                - state
              example: 'state'
            valueCoding:
              type: object
              required:
                - system
                - code
                - display
              properties:
                system:
                  type: string
                  enum:
                    - https://fhir.nhs.uk/STU3/CodeSystem/eRS-ReferralState-1
                  example: https://fhir.nhs.uk/STU3/CodeSystem/eRS-ReferralState-1
                code:
                  type: string
                  enum:
                    # This is just a selection of potential defining states. The full list is still TBC
                    - APPOINTMENT_CANCELLED_BY_PATIENT
                    - AWAITING_TRIAGE
                    - BOOKED
                    - UNBOOKED
                  example: 'APPOINTMENT_CANCELLED_BY_PATIENT'
                display:
                  type: string
                  enum:
                    - 'Appointment Cancelled By Patient'
                    - 'Awaiting Triage'
                    - 'Booked'
                    - 'Unbooked'
                  example: 'Appointment Cancelled By Patient'
        - type: object
          required:
            - url
            - valueCoding
          properties:
            url:
              type: string
              enum:
                - reason
              example: 'reason'
            valueCoding:
              type: object
              required:
                - system
                - code
              properties:
                system:
                  type: string
                  enum:
                    - _baseurl_/STU3/CodeSystem/APPOINTMENT-CANCELLATION-REASON
                    - _baseurl_/STU3/CodeSystem/REFERRAL-CANCELLATION-REASON
                    - https://fhir.nhs.uk/STU3/CodeSystem/eRS-ReviewOutcome-1
                    - https://fhir.nhs.uk/STU3/CodeSystem/eRS-ReviewReason-1
                  example: https://fhir.nhs.uk/STU3/CodeSystem/eRS-ReviewOutcome-1
                code:
                  type: string
                  example: 'PATIENT_ILL'
                display: 
                  type: string
                  example: 'Patient Ill'
        - type: object
          required:
            - url
            - valueString
          properties:
            url:
              type: string
              enum:
                - comments
              example: 'comments'
            valueString:
              type: string
              example: "Patient could not attend appointment due to them being ill."
