# This is an OpenAPI Specification (https://swagger.io/specification/)
# for the e-Referral Service API
# owned by NHS Digital (https://digital.nhs.uk/)
openapi: 3.0.0
x-nhsd-api-platform:
  meta:
    service_name: e-referrals-service-api
    short_service_name: ers
    service_base_path: referrals
    product_display_name: e-Referrals-Service
    product_description: 'The NHS e-RS vision is to enable local innovation and adoption of paperless referrals. To support this vision NHS Digital have created a set of APIs which provide a well-defined, simple to use data interface to the NHS e-Referral Service (e-RS). See https://developer.nhs.uk/apis/e-Referrals/index.html'
    pipeline_name_prefix: E-Referrals-Service
info:
  version: 0.0.1
  title: e-Referrals Service
  description: |
    ## Overview
    Use this API to create paperless referrals from primary to secondary care with the [e-Referral Service (e-RS)](https://digital.nhs.uk/services/e-referral-service).

    As a primary care referrer, you can:

      -	create a new e-referral
      - search for relevant patient services to create a shortlist
      -	access existing e-referrals
      -	create a triage request for the Referral Assessment Service (RAS)
      -	upload and manage a patient letter or attachments, linking them to a referral
      -	retrieve appointment slots and book appointments
      -	defer a booking to a provider if an appointment slot is unavailable

    As a secondary care provider, you can:

      -	access referrals as a worklist
      -	retrieve non-clinical information (meta-data) about the referral
      -	retrieve attachments which are linked to a referral or triage (RAS) request
      -	retrieve clinical information which has been provided by a referrer
      -	accept or reject a referral request
      -	retrieve ‘Advice & Guidance’ (A&G) conversations and send responses
      -	convert ‘Advice & Guidance’ (A&G) conversations into a referral

    You cannot currently use this API to:

      -	get patient details – instead, use the [[HYPERLINK_PDS]]

    You can access the following data:

      -	referral attachments
      -	referral letters
      -	appointment slots
      -	worklists for ‘Referral Requests’
      -	worklists for triage requests (also known as ‘Referral Assessment Service’ (RAS) requests)
      -	worklists for ‘Advice and Guidance’ (A&G) requests
      -	conversation histories for ‘Advice and Guidance’ (A&G) requests


    ### Access modes
    
    For users *within* the Health and Social Care Network (HSCN) who have smartcards: 
    this access mode is in production and [stable](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#api-status). 
    This access mechanism is documented on the older ['API Hub' documentation portal](https://developer.nhs.uk/apis/e-Referrals/getstarted_get_connected.html). 
    Using this authentication mechanism allows full use of all e-RS APIs - including those for 
    [referrers](https://developer.nhs.uk/apis/e-Referrals/creating_referrals.html) and 
    [providers](https://developer.nhs.uk/apis/e-Referrals/receiving_referrals.html).

    For users *without* access to the Health and Social Care Network (HSCN), or who have do not have access to smartcards: 
    early access to our new non-smartcard, non-HSCN authentication mechanism is also now possible via 
    [NHS API management platform](https://digital.nhs.uk/developer/guides-and-documentation/api-management-vision) over the Internet. 
    Please note that this is currently in [beta](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#api-status), 
    meaning we might make breaking changes, but only if we cannot avoid it. The documentation you are currently reading is being updated 
    regularly, as additional endpoints become accessible under this new mechanism. Currently this authentication only allows use of 
    the [Referrer APIs](https://developer.nhs.uk/apis/e-Referrals/creating_referrals.html).

    ## Who can use this API

    You can use this API if you are a software supplier or independent entities 
    (such as a group of GP practices) wishing to interact with the e-referrals service (e-RS) data. Note:

      -	you must have justification for doing so
      -	as an e-RS Partner, we offer you guidance and support for onboarding via the "e-RS Partners Service" which can be contacted via emailing [nhserspartners@nhs.net](mailto:nhserspartners@nhs.net)
      -	you must register with the [e-RS Partners Service](https://developer-test.nhs.uk/apis/e-Referrals/getstarted_partner_registration.html)
      -	you must [assure](https://developer.nhs.uk/apis/e-Referrals/assure_compliance_approach.html) your solution before we grant access to live data
      -	clinical safety remains your responsibility (and the responsibility if your end user organisations), as laid out in the NHS e-RS Integration API [compliance approach](https://developer.nhs.uk/apis/e-Referrals/assure_compliance_approach.html)

    Also see the on-boarding section below for more information.


    ## Related APIs

    The following API also gives access to the e-referrals service (e-RS) data:

      - [e-RS FHIR v2 API](https://developer.nhs.uk/apis/e-Referrals/explore_endpoint_catalogue.html) - this is deprecated and we plan to retire it. Do not integrate with this API


    ## API status and roadmap

    The e-RS FHIR STU3 API is [stable](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#api-status), when accessed via HSCN network with a smartcard. 

    The e-RS FHIR STU3 API is in [beta](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#api-status) when accessed via the internet. Note: there is 
    also one e-RS FHIR R4 endpoint, for Retrieve Practitioner Roles, as part of our beta. We plan to move more endpoints into the FHIR R4 standard in the future, as part of 
    our [roadmap](https://digital.nhs.uk/services/e-referral-service/the-future-of-the-nhs-e-referral-service#future-service-roadmap). 

    For the current e-RS roadmap see [the future of the NHS e-referral service](https://digital.nhs.uk/services/e-referral-service/the-future-of-the-nhs-e-referral-service#future-service-roadmap).

    ## Technology

    This API is primarily [RESTful](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#basic-rest) 
    and based on [FHIR](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir) global standards for health care data exchange.

    ## Network access

    This API is available on the internet and, indirectly, on the [Health and Social Care Network (HSCN)](https://digital.nhs.uk/services/health-and-social-care-network).

    To use this API with NHS smartcards you do need an HSCN connection, although internet-facing alternatives are available.

    For more details see [Network access for APIs](https://digital.nhs.uk/developer/guides-and-documentation/network-access-for-apis).


    ## Security and authorisation

    For users with access to the [Health and Social Care Network (HSCN)](https://digital.nhs.uk/services/health-and-social-care-network), 
    access is [user-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis), 
    meaning an end user must be present, authenticated and authorised.

    The end user must also be:

      -	a healthcare worker
      -	strongly authenticated using an NHS smartcard

    For more details see [Authentication and Authorisation](https://developer.nhs.uk/apis/e-Referrals/develop_business_flow_bf001.html).

    If you wish to authenticate users without smartcards, access is still [user-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis) 
    but uses the following security patterns instead:

      -	[user-restricted RESTful API - using NHS CIS2 - combined authentication and authorisation](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-cis2-combined-authentication-and-authorisation)
      -	[user-restricted RESTful API - using NHS CIS2 - separate authentication and authorisation](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-cis2-separate-authentication-and-authorisation)

    ## Environments and testing

    | Environment       | Base URL                                                               |
    | ----------------- | ---------------------------------------------------------------------- |
    | Sandbox           | `https://sandbox.api.service.nhs.uk/referrals` |
    | Integration test  | `https://int.api.service.nhs.uk/referrals` |
    | Production        | `https://api.service.nhs.uk/referrals` |

    ### Sandbox testing
    Our [sandbox environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#sandbox-testing):
      -	is for early developer testing
      -	only covers a limited set of scenarios
      -	is stateless, so does not actually persist any updates
      -	is open access, so does not allow you to test authorisation

    Try out the sandbox using our 'Try this API' feature, see the documentation for each endpoint. 
    Note: the sandbox will only respond to an input which exactly matches one of the examples provided, it is otherwise stateless.

    ### Integration testing

    Our integration test environment:

      -	is for formal integration testing
      -	is stateful, so persists updates


    ### Production smoke testing

    You must not use real patient data for smoke testing in the production environment. 

    ## Onboarding

    You need to get your software approved by us before it can go live with this API. We call this onboarding. 
    The onboarding process can sometimes be quite long, so it’s worth planning well ahead.

    To onboard for this API, follow 
    the [Supplier Conformance Assessment List (SCAL) process](https://digital.nhs.uk/developer/guides-and-documentation/onboarding-process#onboard-using-the-supplier-conformance-assessment-list-scal-process).

    When following the SCAL process, note that:

    In step 1: to confirm your use case for this API, you need to register with [nhserspartners@nhs.net](mailto:nhserspartners@nhs.net) 
    using [Partner Registration](https://developer.nhs.uk/apis/e-Referrals/getstarted_partner_registration.html) and 
    discuss your use case with us.

    In step 2: when requesting the SCAL, please liaise with [functional.assurance@nhs.net](mailto:functional.assurance@nhs.net) directly, 
    they are responsible for solutions assurance of e-RS APIs.

    In step 8: to organise witness testing of your solution, please liaise with [functional.assurance@nhs.net](mailto:functional.assurance@nhs.net) directly.

    In step 11: when submitting your SCAL for review, please liaise with [functional.assurance@nhs.net](mailto:functional.assurance@nhs.net) directly.

    In step 12: to obtain a Connection Agreement, please liaise with [interop.mgmt@nhs.net](mailto:interop.mgmt@nhs.net). 
    You will need to provide your approved SCAL including an embedded Technical Conformance Certificate.

    In step 13: to obtain the End User Organisation Acceptable Use Policy, please liaise with [interop.mgmt@nhs.net](mailto:interop.mgmt@nhs.net).

    In step 14: to request production access, you need to liaise with both [interop.mgmt@nhs.net](mailto:interop.mgmt@nhs.net) (for all methods of access) and 
    also [api.management@nhs.net](mailto:api.management@nhs.net) if your users are not on HSCN, using smartcards.


  contact:
    url: 'https://digital.nhs.uk/developer/help-and-support'
    email: api.management@nhs.net
  license:
    name: MIT
servers:
  - url: 'https://internal-dev-sandbox.api.service.nhs.uk/referrals-pr-13'
    description: Pr Sandbox environment.
  - url: 'https://sandbox.api.service.nhs.uk/referrals'
    description: Sandbox environment.
  - url: 'https://int.api.service.nhs.uk/referrals'
    description: Integration test environment.
  - url: 'https://api.service.nhs.uk/referrals'
    description: 'Production environment.'
paths:
  /STU3/v1/ReferralRequest/$ers.createReferral:
    post:
      security:
        - bearerAuth: []
      description: |
        ## Overview
        Use this endpoint to create a referral by choosing a shortlist of bookable services.

        Please note: this endpoint cannot be used to shortlist triage services. In order to make use of triage services please use [[HYPERLINK_A021]].

        ## Pre-requisites
        In order to use this endpoint you must be an authenticated e-RS user and use one of the following e-RS roles:
          - `REFERRING_CLINICIAN`
          - `REFERRING_CLINICIAN_ADMIN`
        
        You need to have identified a `patient`, for example via [[HYPERLINK_PDS]].

        You need to have found services that meet the referral needs of a patient using [[HYPERLINK_A010]].

        ## Use case
        As an authenticated user

        I need to create a shortlist of bookable services

        So I can initiate my patients referral pathway, allowing the patient to book into one of the shortlisted services.

        ## Related endpoints
        You can book an appointment for the patient by using [[HYPERLINK_A015]] and [[HYPERLINK_A016]].

        For the referral to be processed by the service provider, you must ensure appropriate referral letter information has been added to the referral. You can add/manage referrer letter information by using [A012 - Maintain referral letter](https://developer.nhs.uk/apis/e-Referrals/explore_endpoint_a012.html).

        You can check to see what referral letter information has already been added to a referral by using [[HYPERLINK_A005]], [[HYPERLINK_A007]], and [[HYPERLINK_A006]] endpoints where necessary.

      summary: A011 - Create referral
      operationId: a011-create-referral
      parameters:
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/OdsCode.yaml'
        - $ref: 'components/schemas/headers/request/BusinessFunction.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: 'components/schemas/eRS-CreateReferral-Parameters.yaml'
            examples:
              rc-minimum-request-body:
                summary: Referring Clinician - minimum request body
                value:
                  $ref: 'components/examples/createReferral/requests/MinimalRequest.json'
              rc-request-body-multi-service-shortlist:
                summary: Referring Clinician - request body using multi-service shortlist
                value:
                  $ref: 'components/examples/createReferral/requests/RequestTwentyServices.json'
              create-referral-parameters-twenty-services:
                summary: Referring Clinician Admin - minimum request body
                value:
                  $ref: 'components/examples/createReferral/requests/MinimalRequestWithReferringClinician.json'
      responses:
        '201':
          $ref: 'components/schemas/responses/createReferral/201Response.yaml'
        '400':
          $ref: 'components/schemas/responses/BadRequest.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '422':
          $ref: 'components/schemas/responses/CreateReferralErrorOutcome.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
  /STU3/v1/ReferralRequest/$ers.createReferralAndSendForTriage:
    post:
      security:
        - bearerAuth: []
      description: |
        ## Overview
        Use this endpoint to refer the patient directly to a triage service.

        Please note: this endpoint cannot be used to shortlist bookable services. In order to shortlist bookable services please use [[HYPERLINK_A011]].
        
        ## Pre-requisites
        In order to use this endpoint you must be an authenticated e-RS user and use one of the following e-RS roles:
          - `REFERRING_CLINICIAN`
          - `REFERRING_CLINICIAN_ADMIN`

        You need to have identified a `patient`, for example via [[HYPERLINK_PDS]].

        You need to have found services that meet the referral needs of a patient using [[HYPERLINK_A010]].

        ## Use case
        As an authenticated e-RS user

        I need to send the patient's referral to a triage service for assessment

        So that I can put the patient on the appropriate clinical pathway for the chosen service provider.

        ## Related endpoints

        For the referral to be processed by the service provider, you must ensure appropriate referral letter information has been added to the referral. You can add/manage referrer letter information by using [[HYPERLINK_A012]].

        You can check to see what referral letter information has already been added to a referral by using [[HYPERLINK_A005]], [[HYPERLINK_A007]], and [[HYPERLINK_A006]] endpoints where necessary.

      summary: A021 - Create referral and send for triage
      operationId: a021-create-referral-request-and-send-for-triage
      parameters:
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/OdsCode.yaml'
        - $ref: 'components/schemas/headers/request/BusinessFunction.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: 'components/schemas/eRS-CreateReferralAndSendForTriage-Parameters.yaml'
            examples:
              parameters:
                summary: Referring Clinician creates referral to a Triage service
                value:
                  $ref: 'components/examples/createReferralAndSendForTriage/requests/Parameters.json'
              parameters-with-named-clinician:
                summary: Referring Clinician Admin minimum call
                value:
                  $ref: 'components/examples/createReferralAndSendForTriage/requests/ParametersWithNamedClinician.json'
      responses:
        '201':
          $ref: 'components/schemas/responses/createReferralAndSendForTriage/201Response.yaml'
        '400':
          $ref: 'components/schemas/responses/BadRequest.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '422':
          $ref: 'components/schemas/responses/CreateReferralErrorOutcome.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
  /STU3/v1/HealthcareService/$ers.searchHealthcareServicesForPatient:
    post:
      security:
        - bearerAuth: []
      description: |
        ## Overview
        Use this endpoint to find services that meet the referral needs of a patient.

        ## Pre-requisites
        In order to use this endpoint you must be an authenticated e-RS user and use one of the following e-RS roles:
          - `REFERRING_CLINICIAN`
          - `REFERRING_CLINICIAN_ADMIN`
        
        You need to have identified a `patient`, for example via [[HYPERLINK_PDS]].

        ## Use case
        As an authenticated user

        I need to find services I can refer the patient to

        So that I can offer the patient appropriate services that meet their referral needs

        ## Related endpoints
        Once you have identified appropriate services for the patient you can either:
          - create a referral by choosing a shortlist of bookable services using [[HYPERLINK_A011]], or
          - refer the patient directly to a triage service using [[HYPERLINK_A021]]
      summary: A010 - Patient service search
      operationId: a010-patient-service-search
      parameters:
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/OdsCode.yaml'
        - $ref: 'components/schemas/headers/request/BusinessFunction.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: 'components/schemas/eRS-PatientServiceSearch-Parameters.yaml'
            examples:
              rc-minimal:
                summary: Referring Clinician minimal search
                value:
                  $ref: 'components/examples/patientServiceSearch/requests/RcMinimal.json'
              rc-search-by-clinical-term:
                summary: Referring Clinician search by clinical term
                value:
                  $ref: 'components/examples/patientServiceSearch/requests/RcSearchByClinicalTerm.json'
              rc-search-by-named-clinician:
                summary: Referring Clinician search by named clinician
                value:
                  $ref: 'components/examples/patientServiceSearch/requests/RcSearchByNamedClinician.json'
              rca-with-iwt:
                summary: Referring Clinician Admin search
                value:
                  $ref: 'components/examples/patientServiceSearch/requests/RcaWithIWT.json'
      responses:
        '200':
          $ref: 'components/schemas/responses/patientServiceSearch/200Response.yaml'
        '400':
          $ref: 'components/schemas/responses/BadRequest.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '422':
          $ref: 'components/schemas/responses/patientServiceSearch/ErrorOutcome.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
  /STU3/v1/CodeSystem/{codeSystemType}:
    parameters:
      - $ref: 'components/schemas/path/CodeSystemType.yaml'
    get:
      security:
        - bearerAuth: []
      description: |
        ## Overview
        Use this endpoint to retrieve a list of reference data codes along with the user-friendly display values used in the e-RS Professional Application.
        
        ## Pre-requisites
        In order to use this endpoint you must be an authenticated e-RS user and use one of the following e-RS roles:
          - `REFERRING_CLINICIAN`
          - `REFERRING_CLINICIAN_ADMIN`
          - `SERVICE_PROVIDER_CLINICIAN`

        ## Use case
        As an authenticated e-RS user

        I need to retrieve e-RS reference data

        So I can use it with other endpoints or display the reference data in a user-friendly format to my users.
        
        ## Related endpoints
        Reference data may be needed for other endpoints, for example when including Specialty and Clinic Type reference data to:
        - find services that meet the referral needs of a patient using [[HYPERLINK_A010]], and
        - create a referral using [[HYPERLINK_A011]] or [[HYPERLINK_A021]]
        
        You may also wish to present the user-friendly names for the reference data, for example when viewing the referral using [[HYPERLINK_A005]]
        
        ## Sandbox test scenarios
        You can test the following scenarios in our sandbox environment
        
        | Scenario                                                | Request                                            | Response                        |
        | ------------------------------------------------------- | -------------------------------------------------- | ------------------------------- |
        | Retrieve speciality reference data                      | `codeSystemType`=`SPECIALTY`                       | Specialty details               |
        | Retrieve clinic type reference data                     | `codeSystemType`=`CLINIC-TYPE`                     | Clinic type details             |
        | Retrieve appointment cancellation reason reference data | `codeSystemType`=`APPOINTMENT-CANCELLATION-REASON` | Appointment reason type details |
        
      summary: A004 - Retrieve reference data
      operationId: a004-retrieve-reference-data
      parameters:
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/OdsCode.yaml'
        - $ref: 'components/schemas/headers/request/BusinessFunction.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
      responses:
        '200':
          $ref: 'components/schemas/responses/getCodeSystem/200Response.yaml'
        '400':
          $ref: 'components/schemas/responses/BadRequest.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '404':
          $ref: 'components/schemas/responses/NotFound.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
  /STU3/v1/Slot:
    get:
      description: |
        ## Overview
        Use this endpoint to retrieve available appointment slots for a service.

        ## Pre-requisites
        In order to use this endpoint you must be an authenticated e-RS user and use one of the following e-RS roles:
          - `REFERRING_CLINICIAN`
          - `REFERRING_CLINICIAN_ADMIN`

        You need to have identified a directly bookable `service` that is on the current referral shortlist. You can do this by using [[HYPERLINK_A005]].

        ## Use case

        As an authenticated e-RS user

        I need to retrieve a list of available appointment slots for a service

        So that I can offer them to the patient for booking.

        ## Important note
        You need to provide the 'commissioning rule organisation' when calling A015 - Retrieve appointment slots to ensure only suitable slots are returned. You can obtain the 'commissioning rule organisation' from [[HYPERLINK_A005]].
        
        ## Related endpoints

        You can book an appointment to an available slot using [[HYPERLINK_A016]].

        You can defer booking to a directly bookable service using [[HYPERLINK_A016]] but only in the following circumstances:
          - when the service has no available slots
          - when trying to book an appointment into a service, the slot advertised is no longer available
          - when trying to book an appointment into a service, no response is received within message timeout period (currently 2 minutes)

        ## Sandbox test scenarios

        You can test the following scenarios in our sandbox environment:

        | Scenario                               | Request Query Parameters                                                                                                                                          | Response                                                                |
        | -------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- |
        | Minimum slot search                    | `schedule.actor:HealthcareService`=`12000`, `appointmentType`=`ROUTINE`, `_count`=`20`, `status`=`free`, `page`=`1`                                               | Illustrates minimum usage/parameters with concise, minimal response.    |
        | Empty slot search response             | `schedule.actor:HealthcareService`=`10000`, `appointmentType`=`ROUTINE`, `_count`=`20`, `status`=`free`, `page`=`1`                                               | Illustrates how a 'no slots' response appears.                          |
        | Multipage slot search (page 1)         | `schedule.actor:HealthcareService`=`11000`, `appointmentType`=`ROUTINE`, `_count`=`5`, `status`=`free`, `page`=`1`                                                | Illustrates first page of multi-page response.                          |
        | Multipage slot search (page 2)         | `schedule.actor:HealthcareService`=`11000`, `appointmentType`=`ROUTINE`, `_count`=`5`, `status`=`free`, `page`=`2`                                                | Illustrates second page of multi-page response.                         |
        | Multipage slot search (invalid page 5) | `schedule.actor:HealthcareService`=`11000`, `appointmentType`=`ROUTINE`, `_count`=`5`, `status`=`free`, `page`=`5`                                                | Illustrates error when page is outside of valid range.                  |
        | Multi schedule response                | `schedule.actor:HealthcareService`=`13000`, `appointmentType`=`ROUTINE`, `_count`=`5`, `status`=`free`, `page`=`1`                                                | Illustrates response when there is >1 Schedule: one Schedule is for slots with no associated clinician and the other does have an associated clinician. |
        | Slot clinician search                  | `schedule.actor:HealthcareService`=`14000`, `schedule.actor:Practitioner`=`921600556514`, `appointmentType`=`ROUTINE`, `_count`=`5`, `status`=`free`, `page`=`1`  | Illustrates search for clinician-specific slots                         |

      summary: A015 - Retrieve appointment slots
      operationId: a015-retrieve-appointment-slots
      parameters:
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/OdsCode.yaml'
        - $ref: 'components/schemas/headers/request/BusinessFunction.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
        - $ref: 'components/schemas/headers/request/ErsXapiCommRuleOrg.yaml'
        - $ref: 'components/schemas/queryParameters/ServiceId.yaml'
        - $ref: 'components/schemas/queryParameters/Priority.yaml'
        - $ref: 'components/schemas/queryParameters/Status.yaml'
        - $ref: 'components/schemas/queryParameters/PageSize.yaml'
        - $ref: 'components/schemas/queryParameters/PageNumber.yaml'
        - $ref: 'components/schemas/queryParameters/NamedClinician.yaml'
        - $ref: 'components/schemas/queryParameters/Include.yaml'
      responses:
        '200':
          $ref: 'components/schemas/responses/retrieveAppointmentSlots/200Response.yaml'
        '400':
          $ref: 'components/schemas/responses/retrieveAppointmentSlots/ErrorOutcome.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
  /R4/v1/PractitionerRole:
    get:
      security:
        - bearerAuth: []
      description: |
        ## Overview
        
        Use this endpoint to retrieve a list of available e-RS roles (i.e. business functions) at each organisation where the user works.

        ## Pre-requisites

        In order to use this endpoint you must be an authenticated user

        ## Use case

        As an authenticated user

        I need to retrieve a list of authorised e-RS roles for organisations I work for

        So I can choose the appropriate role and organisation to work under when performing tasks.

        ## Related endpoints

        You can then use the e-RS roles to perform specific tasks using other e-RS endpoints.

      summary: A030 - Retrieve e-RS business functions
      operationId: a030-retrieve-business-functions
      parameters:
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
      responses:
        '200':
          $ref: 'components/schemas/responses/retrieveBusinessFunctions/200Response.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
  /STU3/v1/Binary:
    post:
      security:
        - bearerAuth: []
      description: |
        ## Overview
        
        Use this endpoint to upload a file containing clinical information to e-RS ready to be associated with a referral.

        ## Pre-requisites
        In order to use this endpoint you must be an authenticated e-RS user and use one of the following e-RS roles:
          - `REFERRING_CLINICIAN`
          - `REFERRING_CLINICIAN_ADMIN`
          - `SERVICE_PROVIDER_CLINICIAN`

        You can only upload file formats that are supported by e-RS. Currently, the supported file formats are:

        | File type          | File extension(s)           |
        | ------------------ | --------------------------- |
        | Plain Text         | `.txt`                      |
        | HTML Text          | `.html,` `.htm`             |
        | PDF                | `.pdf`                      |
        | XML Text           | `.xml`                      |
        | RTF Text           | `.rtf`, `.rtx`              |
        | Basic Audio        | `.au`                       |
        | MPEG audio layer 3 | `.mp3`                      |
        | PNG Image          | `.png`                      | 
        | GIF Image          | `.gif`                      |
        | JPEG Image         | `.jpg,` `.jpe`, `.jpeg`     |
        | TIFF Image         | `.tif`, `.tiff`             |
        | MPEG Video         | `.mpg`, `.mpeg`, `.mpe`     |
        | MSWORD             | `.doc`, `.docx`             |

        Currently, the maximum file size supported by e-RS is 5MB.

        ## Use case

        As an authenticated e-RS user

        I need to upload a referral letter or other clinical information file to e-RS

        So that I can associate the file with an existing referral.

        ## Important notes:

        This endpoint **only** performs the file upload. The uploaded file is **not** associated with a referral until the file has been associated with a referral, for example using [[HYPERLINK_A012]].
        
        The resulting URL within e-RS for the uploaded file is returned in the 'Location' header of the response.

        ## Related endpoints

        You can associate the uploaded file with a specific referral using [[HYPERLINK_A012]].

      summary: A020 - Upload file to document store
      operationId: a020-upload-file-to-document-store
      parameters:
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/OdsCode.yaml'
        - $ref: 'components/schemas/headers/request/BusinessFunction.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
        - $ref: 'components/schemas/headers/request/ErsXapiMetaFilename.yaml'
        - $ref: 'components/schemas/headers/request/ErsXapiMetaIntendedUbrn.yaml'
      requestBody:
        required: true
        content:
          $ref: 'components/schemas/file/FileContentTypeSchema.yaml'
      responses:
        '201':
          $ref: 'components/schemas/responses/uploadFileToDocumentStore/201Response.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '422':
          $ref: 'components/schemas/responses/uploadFileToDocumentStore/422Response.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
  /STU3/v1/ReferralRequest/{ubrn}/$ers.generatePatientLetter:
    post:
      security:
        - bearerAuth: []
      description: |
        ## Overview
        
        Use this endpoint to download a PDF format letter for the patient summarising the current state of their referral and any steps the patient may need to follow.

        ## Pre-requisites
        In order to use this endpoint you must be an authenticated e-RS user and use one of the following e-RS roles:
          - `REFERRING_CLINICIAN`
          - `REFERRING_CLINICIAN_ADMIN`

        You need to use the `Unique Booking Reference Number` (UBRN) of a referral request in order to use this endpoint.

        ## Use case

        As an authenticated e-RS user

        I need to generate the patient letter including up-to-date details about their referral and any steps the patient may need to follow

        So that I can pass it to the patient.

      summary: A019 - Generate patient letter
      operationId: a019-generate-patient-letter
      parameters:
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/OdsCode.yaml'
        - $ref: 'components/schemas/headers/request/BusinessFunction.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
        - $ref: 'components/schemas/path/Ubrn.yaml'
      responses:
        '200':
          $ref: 'components/schemas/responses/generatePatientLetter/200Response.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '404':
          $ref: 'components/schemas/responses/NotFound.yaml'
        '422':
          $ref: 'components/schemas/responses/generatePatientLetter/422Response.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
  /STU3/v1/Binary/{attachmentLogicalID}:
    get:
      security:
        - bearerAuth: []
      description: |
        ## Overview
        
        Use this endpoint to retrieve a file that is attached to a referral or advice request.

        ## Pre-requisites
        In order to use this endpoint you must be an authenticated e-RS user and use one of the following e-RS roles:
          - `REFERRING_CLINICIAN`
          - `REFERRING_CLINICIAN_ADMIN`
          - `SERVICE_PROVIDER_CLINICIAN`

        You need to have retrieved the referral via [[HYPERLINK_A005]] to obtain the URLs for its attachments.

        ## Important note

        A referral pathway in e-RS can be made up of more than one UBRN. 
        For example, a referral is booked and seen in a general knee clinical assessment service (UBRN #1), 
        and the service decides to onward refer to a more specialist knee miniscus service (UBRN #2). 
        This would result in two UBRNs for the referral pathway in this example (but there could be more related UBRNs if onward referred multiple times).

        As such, it is important that all clinical information is obtained from across all the related UBRNs referenced in [[HYPERLINK_A005]]. 
        You can do this using the following endpoints:

          - [[HYPERLINK_A007]]
          - A006 - Retrieve Attachment

        Note: It is possible that the initial UBRN may be the only one in the referral pathway to have clinical information and/or attachments associated.
        
        ## Use case

        As an authenticated e-RS user

        I need to retrieve a clinical attachment associated with a referral

        So that I can assess its content and decide what further action may be needed.

        ## Related endpoints
        
        You can retrieve a clinical information summary for a referral using [[HYPERLINK_A007]].

      summary: A006 - Retrieve attachment
      operationId: a006-retrieve-attachment
      parameters:
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/OdsCode.yaml'
        - $ref: 'components/schemas/headers/request/BusinessFunction.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
        - $ref: 'components/schemas/path/AttachmentLogicalID.yaml'
      responses:
        '200':
          $ref: 'components/schemas/responses/retrieveAttachment/200Response.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '404':
          $ref: 'components/schemas/responses/NotFound.yaml'
        '406':
          $ref: 'components/schemas/responses/NotAcceptable.yaml'
        '422':
          $ref: 'components/schemas/responses/retrieveAttachment/422Response.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
  /STU3/v1/ReferralRequest/{ubrn}:
    get:
      security:
        - bearerAuth: [ ]
      description: |
        ## Overview
        Use this endpoint to retrieve details of a referral. This includes references to clinical attachments, related referrals and other important data.

        ## Pre-requisites

        In order to use this endpoint you must be an authenticated e-RS user and use one of the following e-RS roles:
          - `REFERRING_CLINICIAN`
          - `REFERRING_CLINICIAN_ADMIN`
          - `SERVICE_PROVIDER_CLINICIAN`

        You need to use the `Unique Booking Reference Number` (UBRN) of a referral request in order to retrieve details of a referral.

        ## Use case

        As an authenticated e-RS user

        I want to read details of a referral

        So that I can decide what further action may be needed.

        ## Related endpoints

        You can retrieve attachments that are associated with the referral using [[HYPERLINK_A006]]

        You can retrieve a clinical information summary for the referral using [[HYPERLINK_A007]]

        You can search for services appropriate to a referral to form a shortlist using [[HYPERLINK_A010]]

        If bookable services are on the shortlist of the referral, you can retrieve appointment slots for a service on the shortlist for a referral using [[HYPERLINK_A015]]

        You can retrieve the patient letter appropriate to the referral using [[HYPERLINK_A019]]

        ## Sandbox test scenarios

        You can test the following scenarios in our sandbox environment
        
        | Scenario                                                                 | Request                 |
        | ------------------------------------------------------------------------ | ----------------------- |
        | Unbooked `ReferralRequest`                                               | `ubrn`=`000000070000`   |
        | `ReferralRequest` booked to directly-bookable service                    | `ubrn`=`000000070001`   |
        | `ReferralRequest` booked to indirectly-bookable service                  | `ubrn`=`000000070002`   |
        | `ReferralRequest` deferred to service provider for booking               | `ubrn`=`000000070003`   |
        | `ReferralRequest` that was converted from an Advice and Guidance Request | `ubrn`=`000000070004`   |
        | `ReferralRequest` with related `ReferralRequest`                         | `ubrn`=`000000070005`   |

      summary: A005 Retrieve Referral Request
      operationId: a005-retrieve-referral-request
      parameters:
        - $ref: 'components/schemas/path/Ubrn.yaml'
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/OdsCode.yaml'
        - $ref: 'components/schemas/headers/request/BusinessFunction.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
      responses:
        '200':
          $ref: 'components/schemas/responses/retrieveReferralRequest/200Response.yaml'
        '400':
          $ref: 'components/schemas/responses/BadRequest.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '404':
          $ref: 'components/schemas/responses/NotFound.yaml'
        '422':
          $ref: 'components/schemas/responses/retrieveReferralRequest/422Response.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
  /STU3/v1/ReferralRequest/{ubrn}/_history/{version}:
    get:
      security:
        - bearerAuth: [ ]
      description: |
        ## Overview
        
        Use this endpoint to retrieve a specific version of `ReferralRequest`.

        ## Pre-requisites

        The pre-requisites for this endpoint are the same as for endpoint [[HYPERLINK_A005]].

        Note: e-RS only supports the retrieval of the most recent version of `ReferralRequest`. You cannot retrieve earlier versions.

        ## Use case

        See [[HYPERLINK_A005]].

        ## Related endpoints

        See [[HYPERLINK_A005]].

        ## Sandbox test scenarios
        You can test the following scenarios in our sandbox environment
        
        | Scenario                                                                 | Request                               |
        | ------------------------------------------------------------------------ | ------------------------------------- |
        | Unbooked `ReferralRequest`                                               | `ubrn`=`000000070000`, `version`=`5`  |
        | `ReferralRequest` booked to directly-bookable service                    | `ubrn`=`000000070001`, `version`=`5`  |
        | `ReferralRequest` booked to indirectly-bookable service                  | `ubrn`=`000000070002`, `version`=`5`  |
        | `ReferralRequest` deferred to service provider for booking               | `ubrn`=`000000070003`, `version`=`5`  |
        | `ReferralRequest` that was converted from an Advice and Guidance Request | `ubrn`=`000000070004`, `version`=`5`  |
        | `ReferralRequest` with related `ReferralRequest`                         | `ubrn`=`000000070005`, `version`=`5`  |

      summary: A005 Retrieve Referral Request (Versioned)
      operationId: a005-retrieve-referral-request-versioned
      parameters:
        - $ref: 'components/schemas/path/Ubrn.yaml'
        - $ref: 'components/schemas/path/Version.yaml'
        - $ref: 'components/schemas/headers/request/BearerAuthorization.yaml'
        - $ref: 'components/schemas/headers/request/OdsCode.yaml'
        - $ref: 'components/schemas/headers/request/BusinessFunction.yaml'
        - $ref: 'components/schemas/headers/request/CorrelationID.yaml'
      responses:
        '200':
          $ref: 'components/schemas/responses/retrieveReferralRequest/200Response.yaml'
        '400':
          $ref: 'components/schemas/responses/BadRequest.yaml'
        '401':
          $ref: 'components/schemas/responses/Unauthorized.yaml'
        '403':
          $ref: 'components/schemas/responses/Forbidden.yaml'
        '404':
          $ref: 'components/schemas/responses/NotFoundVersioned.yaml'
        '422':
          $ref: 'components/schemas/responses/retrieveReferralRequest/422Response.yaml'
        '500':
          $ref: 'components/schemas/responses/InternalServerError.yaml'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
     
